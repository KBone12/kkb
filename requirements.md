# 家計簿アプリ要件定義書

## 1. プロジェクト概要

### 1.1 目的
GnuCashの利点（ローカル完結、複式簿記対応）を維持しつつ、スマホ対応と日本語入力の問題を解決した個人用家計簿アプリを開発する。

### 1.2 開発体制・期間
- 開発者：1名（Claude Codeを活用）
- 開発期間：実働1〜2週間で最低限の機能を実装
- 段階的な機能追加を想定

### 1.3 技術スタック方針
- **推奨：** 枯れた技術、長期的に保守可能なもの
- **基本方針：** Webアプリ（SPA）
  - フロントエンド：TypeScript + バニラJS または 最小限のフレームワーク
  - バックエンドロジック：複雑な処理が必要な場合はRust（WASM化）も検討
    - メリット：テストしやすい、型安全、パフォーマンス
    - 判断基準：ロジックの複雑さ次第で段階的に導入
  - データ保存：ローカルファイル（JSON/SQLite）+ クラウド同期オプション
- **避けたいもの：** 複雑なフレームワーク（Reactは限定的にOK）
- **配布方法：** PWA（Progressive Web App）またはTauriでデスクトップアプリ化も検討

---

## 2. 現状分析

### 2.1 現在使用中のツール
- **GnuCash**
- 利用期間：長期
- データ蓄積：あり（既存データのインポートが必要）

### 2.2 現状の課題
1. **スマホ版が実質的に存在しない**
   - 外出先での臨時入力ができない
   - 特に現金決済（レシート無し）時の即時記録に不便
2. **日本語入力の文字化け**
   - 補完機能と日本語入力の相性が悪い
   - 回避方法はあるがストレスが溜まる

### 2.3 現状の運用フロー
- **基本：** 月1回、PCでまとめて入力
- **臨時：** 現金決済時などにその場で記録したいニーズあり
- **デバイス：** 外出時はスマホ、在宅時はPC

---

## 3. 機能要件

### 3.1 必須機能（MVP: Minimum Viable Product）

#### 3.1.1 データ管理
- **ローカルファイル保存**
  - ファイル形式：JSON または SQLite
  - ユーザーが保存場所を指定可能
  - データはローカルで完結（クラウド同期は任意）
- **GnuCashデータのインポート**
  - ファイル形式：XML（gzip圧縮された .gnucash ファイル）
  - 処理フロー：gzip解凍 → XML解析 → データ変換
  - 既存の勘定科目構造を取り込み
  - 過去の取引履歴をインポート
  - 初回セットアップ時に実行
- **バックアップ機能**
  - 定期的な自動バックアップ
  - 複数世代のバックアップ保持
  - 手動バックアップも可能

#### 3.1.2 勘定科目管理
- **階層構造の勘定科目**
  - 大分類：資産・負債・純資産・収益・費用
  - 中分類・小分類：自由に設定可能
  - 例：資産 > 普通預金 > [銀行名・支店名]
- **勘定科目の追加・編集**
  - 期中の追加は可能
  - 変更は年1回程度を想定
  - 削除は使用履歴がある場合は非表示化
- **初期設定**
  - GnuCashのデフォルト科目をベースに
  - ユーザーがカスタマイズ済みの構造をインポート

#### 3.1.3 取引入力（PC版）
- **仕訳形式での入力**
  - 日付、摘要、借方科目、借方金額、貸方科目、貸方金額
  - 複数行の仕訳にも対応（将来的に）
  - 簡易入力モード：「現金 → 食費」のような直感的な入力も可
- **入力補助機能**
  - 取引テンプレート登録・呼び出し
  - よく使う仕訳パターンを保存
  - （オプション）過去の取引履歴からの候補表示
- **入力時の検証**
  - 借方・貸方の合計一致チェック
  - 必須項目の入力確認

#### 3.1.4 取引入力（スマホ版）
- **完全な仕訳入力**
  - PC版と同等の機能をスマホでも提供
  - レスポンシブデザインで操作しやすく
  - 最低限の項目（日付、金額、科目）で入力し、後でPCから詳細補完も可能
- **テンプレート呼び出し**
  - よく使う取引を1タップで入力

#### 3.1.5 取引の閲覧・編集
- **取引一覧表示**
  - 日付順、科目別、金額順などでソート
  - 期間指定（月単位、カスタム期間）
- **検索機能**
  - 日付、科目、摘要、金額での検索
  - 複数条件での絞り込み
- **取引の修正・削除**
  - 月1回程度の見直し時に使用
  - 過去の取引も修正可能（ただし警告表示）
  - 削除履歴の保持（オプション）

#### 3.1.6 レポート・分析機能
- **損益計算書**
  - 月次、年次での表示
  - 収益と費用の内訳を表示
- **貸借対照表（バランスシート）**
  - 資産・負債・純資産の現在残高
  - 各科目の内訳を階層表示
- **資産・純資産の推移グラフ**
  - 折れ線グラフで時系列表示
  - 月次データでの表示
- **資産内訳の縦積み棒グラフ**
  - 各資産科目の割合を可視化
  - 月次での推移を表示
- **月次比較**
  - 前月比、前年同月比
  - 主要科目の増減を一覧表示
- **予算管理機能**
  - 費用科目に予算を設定（収益・資産への予算設定は不要）
  - 実績との比較を表示
  - 予算達成率の可視化（GnuCashより見やすく）
    - 費用科目：予算超過が明確に分かる表示
    - プログレスバーや色分けで直感的に把握
  - 予算超過時のアラート表示

---

### 3.2 優先度：高（早期に実装したい機能）

#### 3.2.1 複数通貨対応
- **通貨の管理**
  - JPY、USD、EURなど主要通貨に対応
  - 各取引で使用通貨を指定
- **為替レート管理**
  - 手動での為替レート入力
  - （将来）APIから自動取得
- **外貨資産の管理**
  - 外貨預金、ドル建て投資など
  - 日本円換算での表示も可能

#### 3.2.2 クラウド同期
- **Google Drive連携**
  - データファイルをGoogle Driveに保存
  - PC・スマホ間での自動同期
- **同期の制御**
  - 手動同期と自動同期の選択
  - 競合時の処理（最終更新を優先、または手動選択）

---

### 3.3 優先度：中（あると便利だが後回し可能）

- **定期取引の自動入力**
  - 給与、家賃、サブスクリプションなどの定期的な取引
  - 設定した日付に自動で仕訳を作成
- **CSV/Excel エクスポート**
  - 取引データや集計結果のエクスポート
  - 外部ツールでの分析用
- **タグ機能**
  - 取引にタグを付けて分類
  - タグ別の集計・分析
- **添付ファイル**
  - 取引に関連するファイルを添付（PDFなど）
  - レシート写真は優先度低（容量の問題）

---

### 3.4 優先度：低（将来的な検討事項）

- **家族との共有機能**
  - 複数ユーザーでのデータ共有
  - セキュリティ面の懸念あり
- **締め日の設定**
  - 月末以外の締め日には現状ニーズなし
- **レシート写真の保存**
  - 現在使用しておらず、見返さない可能性が高い
  - 容量の問題もあり

---

## 4. 非機能要件

### 4.1 パフォーマンス
- **起動時間：** 3秒以内
- **取引入力の応答：** 1秒以内
- **レポート生成：** 5秒以内（年間データでも）

### 4.2 データ容量
- **想定データ量：** 年間数千件の取引
- **バックアップ：** 過去10世代程度を保持

### 4.3 セキュリティ
- **データの暗号化：** ローカル保存時に暗号化オプション
- **クラウド同期：** OAuth認証、データは暗号化して保存

### 4.4 互換性
- **PC：** Windows、Linux対応必須、macOS対応も可能であれば
- **スマホ：** iOS、Android対応（Webアプリの場合はブラウザで動作、PWAとして利用可能）

### 4.5 ユーザビリティ
- **日本語入力：** 文字化けなし、IME対応
- **レスポンシブデザイン：** スマホでも操作しやすいUI
- **キーボードショートカット：** 
  - 基本的な操作のみ（Ctrl+S保存、Ctrl+N新規作成など）
  - 覚えやすく、誤操作を防ぐシンプルな構成
  - 複雑なショートカットは実装しない

---

## 5. データ構造

### 5.1 勘定科目（Account）
```
{
  "id": "UUID",
  "name": "科目名",
  "type": "資産|負債|純資産|収益|費用",
  "parent_id": "親科目のID（nullの場合はルート）",
  "currency": "JPY|USD|EUR...",
  "is_active": true,
  "created_at": "timestamp",
  "updated_at": "timestamp"
}
```

### 5.2 取引（Transaction）
```
{
  "id": "UUID",
  "date": "YYYY-MM-DD",
  "description": "摘要",
  "entries": [
    {
      "account_id": "科目ID",
      "debit": 金額（借方）,
      "credit": 金額（貸方）,
      "currency": "通貨コード",
      "exchange_rate": 為替レート（外貨の場合）
    }
  ],
  "is_complete": true,
  "tags": ["タグ1", "タグ2"],
  "created_at": "timestamp",
  "updated_at": "timestamp"
}
```

### 5.3 テンプレート（Template）
```
{
  "id": "UUID",
  "name": "テンプレート名",
  "description": "説明",
  "entries": [
    {
      "account_id": "科目ID",
      "debit": 金額（省略可）,
      "credit": 金額（省略可）
    }
  ],
  "use_count": 使用回数,
  "last_used": "最終使用日時"
}
```

### 5.4 予算（Budget）
```
{
  "id": "UUID",
  "account_id": "科目ID",
  "year": 年,
  "month": 月,
  "amount": 予算額,
  "currency": "通貨コード"
}
```

---

## 6. UI/UX要件

### 6.1 画面構成（PC版）
1. **ダッシュボード**
   - 今月の収支サマリー
   - 資産残高
   - 予算達成状況
   - 最近の取引
2. **取引入力画面**
   - 仕訳入力フォーム
   - テンプレート選択
3. **取引一覧画面**
   - 検索・フィルタ機能
   - 一覧表示・編集
4. **勘定科目管理画面**
   - ツリー表示
   - 追加・編集・削除
5. **レポート画面**
   - 損益計算書
   - 貸借対照表
   - グラフ表示
   - 予算管理
6. **設定画面**
   - バックアップ設定
   - クラウド同期設定
   - インポート/エクスポート

### 6.2 画面構成（スマホ版）
1. **ホーム画面**
   - 簡易サマリー
   - クイック入力ボタン
2. **取引入力画面**
   - 完全な仕訳入力フォーム
   - テンプレート選択
3. **取引一覧画面**
   - 日付別表示
   - スワイプで編集・削除
4. **レポート画面**
   - 主要なグラフのみ
   - 詳細はPC版推奨
5. **設定画面**

### 6.3 デザインガイドライン
- **シンプル・クリーン：** 余計な装飾を排除
- **見やすさ重視：** フォントサイズ、コントラスト
- **直感的な操作：** 迷わない導線
- **ダークモード：** 目に優しい表示オプション

---

## 7. 開発フェーズ

### Phase 1: MVP（最小限の動作する製品）
**目標：1週間**
- [ ] 基本的なデータ構造の実装
- [ ] ローカルファイル保存
- [ ] 勘定科目の管理（追加・編集）
- [ ] 取引の入力（PC版）
- [ ] 取引一覧の表示
- [ ] 基本的なレポート（損益計算書、貸借対照表）

### Phase 2: スマホ対応
**目標：Phase 1完了後 3〜4日**
- [ ] レスポンシブデザイン対応
- [ ] スマホ版UI実装
- [ ] タッチ操作最適化
- [ ] 簡易入力モード

### Phase 3: データ移行・連携
**目標：Phase 2完了後 2〜3日**
- [ ] GnuCashインポート機能
- [ ] クラウド同期（Google Drive）
- [ ] バックアップ機能

### Phase 4: 機能拡張
**目標：Phase 3完了後、随時**
- [ ] テンプレート機能
- [ ] 予算管理機能の改善
- [ ] 複数通貨対応
- [ ] グラフ表示の充実
- [ ] 検索機能の強化

---

## 8. リスクと対策

### 8.1 技術的リスク
- **リスク：** GnuCashデータ形式の解析が困難
  - **対策：** 公式ドキュメント調査、最悪手動CSV経由での移行
- **リスク：** クラウド同期の競合処理が複雑
  - **対策：** 初期はシンプルな上書きロジック、段階的に改善

### 8.2 スコープリスク
- **リスク：** 機能が多すぎて期間内に完成しない
  - **対策：** MVPに集中、段階的リリース

### 8.3 保守性リスク
- **リスク：** 複雑なフレームワークで将来の保守が困難
  - **対策：** 枯れた技術選択、シンプルな設計

---

## 9. 成功基準

### 9.1 機能面
- [ ] GnuCashからのデータ移行が完了
- [ ] スマホから外出先で取引入力ができる
- [ ] 日本語入力が問題なく動作する
- [ ] 月次レポートが正確に表示される

### 9.2 非機能面
- [ ] 起動が速い（3秒以内）
- [ ] 入力がスムーズ（1秒以内）
- [ ] データが失われない（バックアップ機能）

### 9.3 UX面
- [ ] GnuCashと同等以上の使い勝手
- [ ] ストレスなく日常的に使える
- [ ] 操作に迷わない

---

## 10. 次のステップ

1. **技術スタックの最終決定**
   - Rust + Tauri vs Webアプリ（TypeScript）
   - データベース：SQLite vs JSON
2. **プロトタイプ作成**
   - 基本的なデータ構造と画面遷移
3. **Claude Codeへの指示書作成**
   - この要件定義をベースに具体的なタスクに分解
4. **開発開始**
   - Phase 1から順次実装

---

## 付録A: GnuCashとの比較

| 項目 | GnuCash | 新アプリ |
|------|---------|----------|
| 複式簿記 | ◎ | ◎ |
| ローカル完結 | ◎ | ◎ |
| スマホ対応 | × | ◎ |
| 日本語入力 | △（文字化け） | ◎ |
| クラウド同期 | × | ◎ |
| UI/UX | △（古い） | ◎（モダン） |
| 予算管理 | △（見づらい） | ◎（改善） |

---

## 付録B: 想定ユースケース

### ケース1: 月末の一括入力（従来通り）
1. PCを開く
2. 1ヶ月分のレシートやカード明細を見ながら入力
3. テンプレートで定期的な取引を素早く入力
4. 入力後、月次レポートで確認

### ケース2: 外出先での即時入力（新機能）
1. ラーメン屋で現金払い（レシートなし）
2. スマホアプリを開く
3. テンプレート「ラーメン」を選択、または通常の仕訳入力
4. 日付と金額、科目を入力して保存
5. 帰宅後、必要に応じてPCから摘要など詳細を追記・修正

### ケース3: 予算管理（改善機能）
1. 月初に各科目の予算を設定
2. 週次でダッシュボードを確認
3. 予算超過の科目を視覚的に把握
4. 月末に実績を振り返り、翌月の予算を調整

---

---

## 付録C: 更新履歴

### v1.1 (2025-10-17)
- 技術スタック方針を明確化：Webアプリベース、Rust（WASM）は必要に応じて
- GnuCashインポート：gzip解凍が必要な点を追記
- 簡易入力モードと「未完了」フラグを削除
- 予算管理：費用科目のみに絞り、超過判定を明確化
- 互換性：Linux対応を必須に変更
- キーボードショートカット：基本的な操作のみに限定

### v1.0 (2025-10-17)
- 初版作成

---

**文書バージョン：** 1.1  
**作成日：** 2025-10-17  
**最終更新：** 2025-10-17
